<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE busconfig PUBLIC
 "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"
 "https://dbus.freedesktop.org/doc/busconfig.dtd">
<busconfig>
  <policy user="yggd">
    <!-- Only yggd can own the Yggdrasil1 destination name. -->
    <allow own="com.redhat.Yggdrasil1"/>

    <!-- Only yggd can own the Dispatcher1 and Worker1.* destination names. -->
    <allow own="com.redhat.Yggdrasil1.Dispatcher1"/>
    <allow own_prefix="com.redhat.Yggdrasil1.Worker1"/>

    <!-- Only yggd can send messages to Dispatcher1 destination. -->
    <allow send_destination="com.redhat.Yggdrasil1.Dispatcher1"/>
  </policy>

  <policy group="ygg_worker">
    <!-- Workers running as non-root users should be able to
    call "Transmit" method, when worker is in group ygg_worker -->
    <allow send_destination="com.redhat.Yggdrasil1.Dispatcher1"
       send_interface="com.redhat.Yggdrasil1.Dispatcher1"
       send_member="Transmit"/>
  </policy>

  <policy user="root">
    <!-- Only workers should be able to call "Transmit" method -->
    <allow send_destination="com.redhat.Yggdrasil1.Dispatcher1"
       send_interface="com.redhat.Yggdrasil1.Dispatcher1"
       send_member="Transmit"/>
  </policy>

  <policy context="default">
    <!-- Anybody should be able to get list of workers -->
    <allow send_destination="com.redhat.Yggdrasil1"
       send_interface="com.redhat.Yggdrasil1"
       send_member="ListWorkers"/>

    <!-- Everybody should be able to introspect D-Bus API -->
    <allow send_destination="com.redhat.Yggdrasil1"
      send_interface="org.freedesktop.DBus.Introspectable"/>
    <allow send_destination="com.redhat.Yggdrasil1.Dispatcher1"
      send_interface="org.freedesktop.DBus.Introspectable"/>
  </policy>
</busconfig>
